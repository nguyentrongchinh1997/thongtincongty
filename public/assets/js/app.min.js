function Mmm() {
  'use strict';

  this.getAll = function () {
    var _this = this;
    $.ajax({
      type: "POST",
      url: baseUrl + 'api/web/mmm/get-active-banners/',
      data: {},
      success: function (res) {
        _this.loadAds(res.data);
      },
      error: function () {

      }
    });
  };

  this.loadAds = function (data) {
    if (!data || data.length === 0) {
      return;
    }
    for (var i = 0; i < data.length; i++) {
      if (data[i].position) {
        var pos = data[i].position.split(',');
        for (var j = 0; j < pos.length; j++) {
          if (pos[j]) {
            $('.mmm.' + pos[j]).html(data[i].content);
          }
        }
      }
    }
  };
}

$(document).ready(function () {
  var mmm = new Mmm();
  mmm.getAll();
});/**
 * Created by Hoang Thai Hoc on 10/06/2017.
 */
function CompanyDetail() {
  this.getLatestCompany = function(limit, successCallback) {
    $.ajax({
      type: "POST",
      url: baseUrl + 'api/web/company/get-latest/',
      data: {
        'limit': limit
      },
      success: function (data) {
        successCallback(data);
      },
      error: function() {

      }
    });
  };
  this.calculateContent = function() {
    var leftContent = $('#left-content');
    var rightContent = $('#right-content');
    var latestCompanyPanel = $('#latest-company-panel');
    if(leftContent.length > 0 && rightContent.length > 0 && latestCompanyPanel.length > 0) {
      var offset = rightContent.innerHeight() - leftContent.innerHeight() - 60;
      var companyItem = $('.company-item');
      var itemHeight = 120;
      if (companyItem.length > 0) {
        itemHeight = companyItem.innerHeight();
      }
      if(itemHeight > 0) {
        var limit = Math.ceil(offset / itemHeight);
        if(limit > 2) {
          this.getLatestCompany(limit, function (res) {
            if (res.data) {
              latestCompanyPanel.show();
              $('#latest-company-panel .m-panel-content').html(res.data);
            }
          });
        }
      }
    }
  };
}
$(document).ready(function () {
  var CompanyPage = new CompanyDetail();
  CompanyPage.calculateContent();
});function Sim() {
  this.getAll = function () {
    var list = $('#list-sim');
    var type = 0;
    if (list.length > 0 && list.hasClass('list-beautiful-sim')) {
      type = 1;
    }
    var _this = this;
    $.ajax({
      type: "POST",
      url: baseUrl + 'api/web/sim/get-all/',
      data: {
        type: type
      },
      success: function (res) {
        _this.loadView(res.list);
      },
      error: function () {

      }
    });
  };

  this.loadView = function (list) {
    var $container = $('#list-sim');
    for (var i = 0; i < list.length; i++) {
      if (list[i].status > 0) {
        continue;
      }
      var phone = parseInt(list[i].phone);
      phone = phone.toString(10).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      var price = parseInt(list[i].price);
      price = price.toString(10).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      phone = '0' + phone;
      if (list[i].type == 1) {
        $container.append('<li data-phone="' + list[i].phone + '">' +
          '<strong class="sim">' + phone + '</strong><strong class="price">' + price + '<sup>đ</sup></strong>' +
          '<button>' +
          '<a href="javascript:"><i class="fa fa-cart-plus"></i> Mua</a>' +
          '</button>' +
          '</li>');
      } else {
        $container.append('<li data-phone="' + list[i].phone + '"><a href="javascript:"><strong class="sim">' + phone + '</strong><button><i class="fa fa-cart-plus"></i> Mua</button></a></li>');
      }
    }
    this.addEvent();
  };

  this.addEvent = function () {
    $('#list-sim li').on('click', function () {
      var phone = $(this).data('phone');
      $('#selected-sim').val(phone);
      $('#sim-modal').modal('show');
    });
  };

  this.order = function (phone, userName, userPhone, userAddress) {
    showLoading && showLoading();
    var list = $('#list-sim');
    var type = 0;
    if (list.length > 0 && list.hasClass('list-beautiful-sim')) {
      type = 1;
    }
    $.ajax({
      type: "POST",
      url: baseUrl + 'api/web/sim/order/',
      data: {
        'phone': phone,
        'user_name': userName,
        'user_phone': userPhone,
        'user_address': userAddress,
        'type': type
      },
      success: function (res) {
        if (res && res.result === "success") {
          hideLoading && hideLoading();
          alert('Đã đặt mua thành công! Chúng tôi sẽ liên hệ với bạn để xác nhận đơn hàng!');
          $('#sim-modal').modal('hide');
          window.location.reload();
        } else {
          hideLoading && hideLoading();
          alert('Đã có lỗi xảy ra! Vui lòng liên hệ hotline: 0392.920.886 để đặt sim! Xin cảm ơn!');
          $('#sim-modal').modal('hide');
        }
      },
      error: function() {
        hideLoading && hideLoading();
        alert('Đã có lỗi xảy ra! Vui lòng liên hệ hotline: 0392.920.886 để đặt sim! Xin cảm ơn!');
        $('#sim-modal').modal('hide');
      },
      statusCode: {
        400: function() {
          hideLoading && hideLoading();
          alert('Vui lòng nhập đầy đủ thông tin!');
        }
      }
    });
  };
}

$(document).ready(function () {
  if ($('#sim-page').length > 0) {
    var sim = new Sim();
    sim.getAll();
    $('#order-sim-form').on('submit', function (event) {
      event.preventDefault();
      var phone = $(this).find('input[name=phone]').val();
      var userName = $(this).find('input[name=user_name]').val();
      var userPhone = $(this).find('input[name=user_phone]').val();
      var userAddress = $(this).find('input[name=user_address]').val();
      sim.order(phone, userName, userPhone, userAddress);
    });
  }
});
/**
 * Created by Hoang Thai Hoc on 23/07/2017.
 */
function UpdateCompany() {
  'use strict';
  this.okBtn = $("#modal-captcha-btn");
  this.updateModal = $('#update-modal');
  this.refreshCaptchaBtn = this.updateModal.find('button.refresh');
  this.errorModal = $("#update-error-modal");
  this.inputCaptcha = $("#captcha");
  this.mst = null;
  this.countCrawl = 0;
  this.hash = null;

  this.init = function () {
    this.refreshCaptchaBtn.on('click', this.refreshCaptcha.bind(this));
    this.okBtn.on('click', this.verifyCaptcha.bind(this));
    this.countCrawl = window.crawl ? 0 : 5;
    this.hash = null;
  };

  this.openUpdateCompany = function (event, mst) {
    event.preventDefault();
    this.mst = mst;
    showLoading && showLoading();
    this.refreshCaptcha(function () {
      this.updateModal.modal('show');
    }.bind(this), this.showErrorModal.bind(this));
  };

  this.showErrorModal = function () {
    this.errorModal.modal('show');
  };

  this.refreshCaptcha = function (successCallback, failCallback) {
    this.inputCaptcha.val('');
    var captcha = document.getElementById("captcha-image");
    $.ajax({
      type: "POST",
      url: baseUrl + 'api/web/tct/get-captcha/',
      success: function (res) {
        hideLoading && hideLoading();
        if (res && res.captcha) {
          captcha.src = res.captcha + '?t=' + new Date().getTime();
        }
        if (successCallback && typeof successCallback === "function") {
          successCallback();
        }
      },
      error: function () {
        hideLoading && hideLoading();
        if (failCallback && typeof failCallback === "function") {
          failCallback();
        }
      }
    });
  };

  this.verifyCaptcha = function () {
    var input = this.inputCaptcha.val();
    var _this = this;
    if (input) {
      showLoading && showLoading();
      $.ajax({
        type: "POST",
        url: baseUrl + 'api/web/tct/verify-captcha/',
        data: {
          'captcha': input
        },
        success: function (res) {
          if (res && res.data === "Success") {
            _this.getCompanyInfo();
          } else {
            hideLoading && hideLoading();
          }
        },
        error: function () {
          hideLoading && hideLoading();
        },
        statusCode: {
          400: function () {
            hideLoading && hideLoading();
            alert('Vui lòng nhập mã xác nhận!');
          },
          401: function () {
            hideLoading && hideLoading();
            _this.refreshCaptcha();
            alert('Mã xác nhận không đúng!');
          }
        }
      });
    } else {
      alert('Vui lòng nhập mã xác nhận!');
    }
  };

  this.getCompanyInfo = function () {
    var _this = this;
    var postData = {
      'mst': this.mst
    };
    $.ajax({
      type: "POST",
      url: baseUrl + 'api/web/tct/get-data/',
      data: postData,
      success: function (res) {
        if (res && res.data === "Success") {
          if (res.hash) {
            _this.hash = res.hash;
            _this.crawl();
          } else {
            hideLoading && hideLoading();
          }
        } else {
          hideLoading && hideLoading();
        }
      },
      error: function () {
        hideLoading && hideLoading();
        _this.showErrorModal();
      }
    });
  };

  this.goToUpdatePage = function () {
    if (this.hash) {
      window.location.href = baseUrl + 'update/' + this.hash + '/';
    }
  };

  this.crawl = function () {
    var _this = this;
    _this.countCrawl++;
    if (_this.countCrawl >= 4) {
      hideLoading && hideLoading();
      _this.goToUpdatePage();
      return;
    }
    var postData = {};
    $.ajax({
      type: "POST",
      url: baseUrl + 'api/web/tct/crawl/',
      data: postData,
      success: function () {
        _this.crawl();
      },
      error: function () {
        hideLoading && hideLoading();
        _this.goToUpdatePage();
      }
    });
  };

}

$(document).ready(function () {
  var updateCompany = new UpdateCompany();
  updateCompany.init();
  window.openUpdateCompany = function (event, mst) {
    updateCompany.openUpdateCompany(event, mst);
  }
});/**
 * Created by Hoang Thai Hoc on 01/05/2017.
 */

function showLoading(successCallback) {
  $("#loading").show();
  if (successCallback && typeof successCallback === "function") {
    successCallback();
  }
}

function hideLoading(successCallback) {
  $("#loading").hide();
  if (successCallback && typeof successCallback === "function") {
    successCallback();
  }
}